<div class="modal fade" id="create-ingredient" tabindex="-1" role="dialog" aria-labelledby="ModalCreateIngredient" aria-hidden="true">
    <div class="modal-dialog">
        <div class="col modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ModalCreateIngredient">Create New Ingredient</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="CreateIngredientForm" action="/ingredient/manage/" method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="form-group">
                        <input name="new_ingredient" id="Ingredient" class="form-control" type="text" placeholder="Ingredient Name *">
                    </div>
                    <div class="controlsnew-dr form-group">
                        <label>Dietary Restrictions</label>
                        <div>
                            <div class="entrynew-dr input-group mb-3">
                                <select name="new_dietary_restriction_id[]" class="form-control">
                                    <option value=""></option>
                                    {RESTRICTION_OPTIONS}
                                </select>
                                <div class="input-group-append">
                                    <span class="addnew-dr plus-cursor input-group-text"><span class="fa fa-plus"></span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <input name="new_alt_search_terms" id="AltNames" class="form-control" type="text" placeholder="Alternate Names">
                    </div>
                    <div class="form-group">
                        <textarea name="new_description" placeholder="Description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="IngredientImage">Image</label>
                        <input name="new_ingredient_image" type="file" class="form-control-file" style="border: none;" id="IngredientImage">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="reset" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button id="ButtonCreateIngredient" type="submit" class="btn btn-primary btn-ok">Create Ingredient</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <h2 class="my-3">{PAGE_TITLE}</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        {CONTENT}
    </div>
</div>

<script>
    $(document).ready(function () {
        $(document).on('click', '.add-ing', function () {
            var controlDiv = $('.controls-ing div:first'),
                currentEntry = $(this).parents('.entry-ing:first'),
                newEntry = $(currentEntry.clone()).appendTo(controlDiv);

            newEntry.find('input').val('');
            newEntry.find('label').hide();
            controlDiv.find('.entry-ing:not(:last) .add-ing')
                    .removeClass('add-ing').addClass('delete-ing')
                    .html('<span class="fa fa-minus"></span>');
        }).on('click', '.delete-ing', function () {
            $(this).parents('.entry-ing:first').remove();
            $('.controls-ing div:first .entry-ing:first').find('label').show();
            return false;
        });

        $(document).on('click', '.add-step', function () {
            var controlDiv = $('.controls-step'),
                    currentEntry = $(this).parents('.entry-step:first'),
                    newEntry = $(currentEntry.clone()).appendTo(controlDiv);

            newEntry.find('textarea, input[type="file"]').val('');
            newEntry.find('label').hide();
            controlDiv.find('.entry-step:not(:last) .add-step')
                    .removeClass('add-step').addClass('delete-step')
                    .html('<span class="fa fa-minus"></span>');
        }).on('click', '.delete-step', function () {
            $(this).parents('.entry-step:first').remove();
            $('.controls-step li:first .entry-step:first').find('label').show();
            return false;
        });

        $(document).on('click', '.add-rec', function () {
            var controlDiv = $('.controls-rec div:first'),
                    currentEntry = $(this).parents('.entry-rec:first'),
                    newEntry = $(currentEntry.clone()).appendTo(controlDiv);

            newEntry.find('input').val('');
            newEntry.find('label').hide();
            controlDiv.find('.entry-rec:not(:last) .add-rec')
                    .removeClass('add-rec').addClass('delete-rec')
                    .html('<span class="fa fa-minus"></span>');
        }).on('click', '.delete-rec', function () {
            $(this).parents('.entry-rec:first').remove();
            $('.controls-rec div:first .entry-rec:first').find('label').show();
            return false;
        });

        $(document).on('click', '.addnew-dr', function () {
            var controlDiv = $('.controlsnew-dr div:first'),
                currentEntry = $(this).parents('.entrynew-dr:first'),
                newEntry = $(currentEntry.clone()).appendTo(controlDiv);

            newEntry.find('select').val('');
            controlDiv.find('.entrynew-dr:not(:last) .addnew-dr')
                .removeClass('addnew-dr').addClass('deletenew-dr')
                .html('<span class="fa fa-minus"></span>');
        }).on('click', '.deletenew-dr', function () {
            $(this).parents('.entrynew-dr:first').remove();
            return false;
        });
        
        $(document).on('click', '.add-cat', function () {
            var controlDiv = $('.controls-cat div:first'),
                    currentEntry = $(this).parents('.entry-cat:first'),
                    newEntry = $(currentEntry.clone()).appendTo(controlDiv);

            newEntry.find('input').val('');
            controlDiv.find('.entry-cat:not(:last) .add-cat')
                    .removeClass('add-cat').addClass('delete-cat')
                    .html('<span class="fa fa-minus"></span>');
        }).on('click', '.delete-cat', function () {
            $(this).parents('.entry-cat:first').remove();
            return false;
        });

        $(document).on('click', '.add-date', function () {
            var controlDiv = $('.controls-date div:first'),
                currentEntry = $(this).parents('.entry-date:first'),
                newEntry = $(currentEntry.clone()).appendTo(controlDiv);

            newEntry.find('input, textarea').val('');
            controlDiv.find('.entry-date:not(:last) .add-date')
                .removeClass('add-date').addClass('delete-date')
                .html('<span class="fa fa-minus"></span>');
        }).on('click', '.delete-date', function () {
            $(this).parents('.entry-date:first').remove();
            $('.controls-date div:first .entry-date:first').find('label').show();
            return false;
        });

        var optionsCategory = {
            source: "/categories/src/",
            minLength: 2,
            select: function (event, ui) {
                $(this).closest('div').find('input.cat_hidden').val(ui.item.id);
            }
        };

        var selectorCategory = '.ac-cat';

        $(document).on('keydown.autocomplete', selectorCategory, function () {
            $(this).autocomplete(optionsCategory);
        });

        var optionsChina = {
            source: "/china/ac/",
            minLength: 2,
            select: function (event, ui) {
                $(this).closest('div').find('input.china_hidden, input.this_china_id').val(ui.item.id);
            }
        };

        var selector = '.ac-china';

        $(document).on('keydown.autocomplete', selector, function () {
            $(this).autocomplete(optionsChina);
        });

        var optionsRecipe = {
            source: "/recipe/ac_rec/",
            minLength: 2,
            select: function (event, ui) {
                $(this).closest('div').find('input.rec_hidden').val(ui.item.id);
            }
        };

        var selector = '.ac-rec';

        $(document).on('keydown.autocomplete', selector, function () {
            $(this).autocomplete(optionsRecipe);
        });

        var optionsIng = {
            source: "/ingredient/src/",
            minLength: 2,
            select: function (event, ui) {
                $(this).closest('div').find('input.ing_hidden').val(ui.item.id);
            }
        };

        var selector = '.ac-ing';

        $(document).on('keydown.autocomplete', selector, function () {
            $(this).autocomplete(optionsIng);
        });

        $("#createDishForm").validate({
            errorPlacement: function(error, element) {
                error.appendTo( element.parent("div").parent("div") );
            },
            rules: {
                dish_title: {
                    required: true
                },
                // category_name: {
                //     required: true
                // },
                description: {
                    required: true
                },
                source_link: {
                    url: true
                }
            },
            messages: {
                recipe_title: {
                    required: "Please provide Dish Title"
                },
                // category_name: {
                //     required: "Please select category"
                // },
                description: {
                    required: "Please provide Description"
                }
            }
        });

        $('.sortable').sortable();

        $("#CreateIngredientForm").validate({
            rules: {
                new_ingredient: {
                    required: true
                }
            },
            messages: {
                new_ingredient: {
                    required: "Please provide Ingredient Name"
                }
            }
        });

        $('#CreateIngredientForm').submit(function(e) {
            e.preventDefault();

            if (! $(this).valid()) {
                return false;
            }

            $('#ButtonCreateIngredient').attr('disabled', true);
            let formData = new FormData(this);
            $(this)[0].reset();

            $.ajax({
                type: 'post',
                url: '/ingredient/manage/',
                data: formData,
                success: function() {
                    $('#create-ingredient').modal('hide');
                    $('#ButtonCreateIngredient').attr('disabled', false);
                    notif.Promo('top', 'center', '<span>Ingredient saved</span>', 'success');
                },
                error: function() {
                    alert('Error occured: Ingresient has not been saved');
                },
                cache: false,
                contentType: false,
                processData: false
            });
        });
    });
</script>